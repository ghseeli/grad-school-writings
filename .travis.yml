sudo: required
cache:
  directories:
  - texlive
before_install:
- |
  if [[ ! -e ./texlive/bin/x86_64-linux/tlmgr ]]; then
    wget http://mirrors.ctan.org/systems/texlive/Source/install-tl-unx.tar.gz -O - | tar -x --gzip
    mv $(ls | grep install) install-tl
    ./install-tl/install-tl -profile texlive.profile
  fi
- export PATH=$(pwd)/texlive/bin/x86_64-linux:$PATH
- sudo apt-get install texlive-full
- sudo apt-get install latexmk
- tlmgr update --self
- tlmgr update --all
- tlmgr install $(cat .tlmgr-dep)
script:
- chmod a+x scripts/build-pdfs.sh
- scripts/build-pdfs.sh
# Move PDFs to correct location
- |
  for DIR in $(ls -d */ | grep ''); do
    mkdir "docs/$DIR"
    for PATH_REL_SRC in $(ls "$DIR"*.pdf | grep ''); do
      PATH_REL_DEST="docs/$PATH_REL_SRC"
      echo "Moving $PATH_REL_SRC to docs/$DIR folder"
      mv "$PATH_REL_SRC" "$PATH_REL_DEST"
    done
  done
- ls docs/**/*
# Edit webpages to include links for those pdfs
- cd docs
- |
  write_section_links() {
    DIR_NAME="$1"
    OUTPUT_FILENAME="$2"
    OUTPUT_SECTION_TITLE="$3"
    OUTPUT_LINK_PREFIX="$4"
    printf "## $OUTPUT_SECTION_TITLE\n" >> "$OUTPUT_FILENAME"
    for FNAME in $(ls "$DIR_NAME" | grep ''); do
        NAME="$OUTPUT_LINK_PREFIX""$FNAME"
        FPATH="$DIR_NAME/$FNAME"
        printf "[$NAME]($FPATH)  \n" >> "$OUTPUT_FILENAME" # Two spaces before \n tells Markdown to generate <br />
    done
    printf "\n" >> "$OUTPUT_FILENAME"
  }
- write_section_links "Class Notes/Algebra" "class-notes.md" "Algebra" ""
- write_section_links "Class Notes/Geometric Representation Theory" "class-notes.md" "Geometric Representation Theory" ""
- write_section_links "Monographs" "monographs.md" "Monographs" ""
- cd ..
deploy:
  provider: pages
  skip_cleanup: true
  api_key:
    secure: HXgpRlzngKyMJir0Xyqq/WAg4DykW9DMz39MbJE449v0PvY6ruybFTD4SqTl8mAobHHDogRZKTFHDMGdNHAr0pIz/g6lhP+W3/U24QHrMX2g1uwfDTmevmGHfnCXlqroCW9AiYn0RJcPnfzeW0tKMliNVnRYfsXNyNFFjhQj34Nes1L2wJs2Us/eOwNcsrAZhXUn751EXtt/Uka3sLar9wOqgC906buxYMLYuUG5v0eHHR8ZNaSr6K2vKszcP1XaBbzqzbZRUhowFE2Y4rkY4XpDGkgYCqBfhFYowJA10mdq6qNQPTyM7LlDguAN+R1c9iqFmzwMWKVH8/LNSN/Mm152No7jV2eAKLpb7dy8Xe12r2BEnP0bgHkVJHfob3sNLAIQDpzRb3qwsYSt87DnCNabId6nnQcRhoVACzzXJSfU8S95Bz5MS3kJ+RwNpwQFnbzkwkgKNyofSd6ZgXJqO8SntgJQaHMobESUTsf75nA10LqfWvAOPK4HF0ECIhyvvAD84tvY3vjU89Bi+ky40Q9VjewseRicSyfMvhwKGym4I6q9noAxAaDqHxnnezT1c5PLFEQVmiu1YhkIxdugbfDyC1nU38QReucFnxlR+Zr0M/9wjd46NPZQbWFXopqdldsxxr93xhSW2EnLNQbVLAYBE69X6lTrwyAFoKvnXIU=
  local_dir: docs
  on:
    repo: ghseeli/grad-school-writings
    branch: master
